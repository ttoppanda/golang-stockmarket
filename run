#!/usr/bin/env bash

goservices="ledger orderbook ticker"
containers="web_lb web ledger orderbook ticker"

source mock

# TRADE
if [[ $1 == "trade" ]]; then
  time trade
fi

# TEST
if [[ $1 == "test" ]]; then
  for service in $goservices; do
    cd "$service"_service && go test && cd ..
  done
fi

# BUILD ALL PRODUCTION AND PUSH TO DOCKER HUB
if [ $1 == "build" ] && [ $2 == "all" ]; then
    docker-compose -f docker-compose.build.prod.yml build

    for container in $containers; do
        docker push nickstefan/market_$container
    done
fi

# BUILD PRODUCTION AND PUSH TO DOCKER HUB
if [ $1 == "build" ] && [ $2 != "all" ]; then
    docker-compose -f docker-compose.build.prod.yml build
    docker push nickstefan/market_$2
fi


# KUBE HELPERS
if [ $1 == "kube" ] && [ $2 == "deploy" ]; then
    cd kubernetes
    source ./kube-deploy
    cd -
fi

if [ $1 == "kube" ] && [ $2 == "create" ]; then
    cd kubernetes
    source ./kube-create    
    cd -
fi

if [ $1 == "kube" ] && [ $2 == "delete" ]; then
    cd kubernetes
    source ./kube-delete
    cd -
fi

if [ $1 == "kube" ] && [ $2 == "down" ]; then
    source ./kubernetes/kube-conf
    source ./kubernetes/secrets
    $HOME/kubernetes/cluster/kube-down.sh
fi




