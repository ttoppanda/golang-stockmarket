#!/usr/bin/env bashs

#10000 44 seconds, memory: 10, 2.7, 2.2
#1000 3.8 seconds, memory: 5.6, 3.1, 2.9
#500 1.9 seconds, memory: 5.3 orderbook, 2.7 ticker, 2.2 ledger
#250 .9 seconds, memory: 5.1, 2.2, 1.8

function trade { 

  price=$((10))
  timeStamp=$(date +%s)

  tradeUrl=http://192.168.99.100/orderbook
  #tradeUrl=http://52.37.207.43/orderbook

  for i in {1..500}; do
    # sleep 1
    if [[ $[i % 5] == 0 && $[i % 3] == 0 ]]; then
      price=$((price + 10))
      curl -s -H "Content-Type: application/json" -X POST -d '{"uuid": '"$i"',"ticker":"STOCK","orders": [{"bid": '"$price"', "actor": "Bob", "timecreated": '"$((timeStamp))"''"$((i))"', "intent": "BUY", "shares": 100, "state": "OPEN", "ticker": "STOCK", "kind": "LIMIT"}]}' $tradeUrl > /dev/null &
      # echo "  " $i " Bid " $price

    elif [[ $[i % 5] == 0 ]]; then
      price=$((price - 5))
      curl -s -H "Content-Type: application/json" -X POST -d '{"uuid": '"$i"',"ticker":"STOCK","orders": [{"ask": '"$price"', "actor": "Tim", "timecreated": '"$((timeStamp))"''"$((i))"', "intent": "SELL", "shares": 100, "state": "OPEN", "ticker": "STOCK", "kind": "LIMIT"}]}' $tradeUrl > /dev/null &
      # echo "  " $i " Ask " $price

    elif [[ $[i % 3] == 0 ]]; then
      price=$((price - 1))
      curl -s -H "Content-Type: application/json" -X POST -d '{"uuid": '"$i"',"ticker":"STOCK","orders": [{"bid": '"$price"', "actor": "Bob", "timecreated": '"$((timeStamp))"''"$((i))"', "intent": "BUY", "shares": 100, "state": "OPEN", "ticker": "STOCK", "kind": "LIMIT"}]}' $tradeUrl > /dev/null &
      # echo "  " $i " Bid " $price

    else 
      price=$((price + 1))
      curl -s -H "Content-Type: application/json" -X POST -d '{"uuid": '"$i"',"ticker":"STOCK","orders": [{"ask": '"$price"', "actor": "Tim", "timecreated": '"$((timeStamp))"''"$((i))"', "intent": "SELL", "shares": 100, "state": "OPEN", "ticker": "STOCK", "kind": "LIMIT"}]}' $tradeUrl > /dev/null &
      # echo "  " $i " Ask " $price
    fi 

  done
}
